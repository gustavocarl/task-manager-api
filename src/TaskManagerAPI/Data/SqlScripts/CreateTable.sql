use TaskManagerAPI;

CREATE TABLE Users (
    Id UNIQUEIDENTIFIER DEFAULT NEWID(),
    Name NVARCHAR(100) NOT NULL,
    Email NVARCHAR(100) NOT NULL UNIQUE,
    PasswordHash NVARCHAR(max) NOT NULL,
    Role NVARCHAR(50) NOT NULL,
    CreatedAt DATETIME2 DEFAULT SYSDATETIME() NOT NULL,

    CONSTRAINT PK_Users PRIMARY KEY CLUSTERED (Id),
    CONSTRAINT UQ_Users_Email UNIQUE (Email)
);

CREATE TABLE Tasks(
    Id UNIQUEIDENTIFIER DEFAULT NEWID(),
    Title NVARCHAR(100) NOT NULL,
    Description NVARCHAR(max) NULL,
    Priority INT NOT NULL CHECK (Priority IN (0, 1, 2)),
    Status INT NOT NULL CHECK (Status IN (0, 1, 2)),
    DueDate DATETIME NULL,
    UserId UNIQUEIDENTIFIER NOT NULL,
    CreatedAt DATETIME2 DEFAULT SYSDATETIME() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT SYSDATETIME() NOT NULL,

    CONSTRAINT PK_Tasks PRIMARY KEY CLUSTERED (Id),

    CONSTRAINT FK_Tasks_Users FOREIGN KEY (UserId) REFERENCES Users(Id)
        ON DELETE CASCADE
        ON UPDATE CASCADE

);

CREATE INDEX IX_Tasks_UserId ON Tasks(UserId);
